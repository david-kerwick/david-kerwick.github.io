---
layout: post
title: Not enough entropy on RedHat
date: '2014-03-12T20:59:00.000Z'
author: David
tags: 
modified_time: '2014-03-31T21:53:28.621+01:00'
blogger_id: tag:blogger.com,1999:blog-2027514548288128942.post-3776705068099286637
blogger_orig_url: http://davidkerwick.blogspot.com/2014/03/not-enough-entropy-on-redhat.html
---

<h3>Chaos is good....</h3><div><br /></div><div>I found the wlst and the weblogic adminserver kept 'hanging' on me. &nbsp;When doing a domain creation sometimes the script would just stall, when I logged in to check the box things would be ok. &nbsp;Strange says I.</div><div><br /></div><div>Turns out to be kind of a common problem, I set the box up as a virtual machine and since I was only ssh'd into the box I wasn't creating enough entropy for the random pool on redhat. &nbsp;Weblogic does a good bit of ssl and encryption and can use up the pool very quickly, especially a headless dev box as there's next to nothing happening on the box.</div><div><br /></div><div><pre class="brush: bash">watch cat /proc/sys/kernel/random/entropy_avail<br /><br />Every 2.0s: cat /proc/sys/kernel/random/entropy_avail  Wed Mar 12 18:50:13 2014<br /><br />170<br /></pre><div class="p1"><br />Not alot available</div><div class="p1"><br /></div></div><div><div class="p1"><pre class="brush: bash">rngd -r /dev/urandom -o /dev/random</pre></div></div><div class="p1"><br /></div><div class="p1">Much better</div><div class="p1"><br /></div><pre class="brush: bash">Every 2.0s: cat /proc/sys/kernel/random/entropy_avail  Wed Mar 12 19:11:17 2014<br /><br />3200<br /></pre><div class="p1"><br /></div><div class="p1">Of course you'll need a better long term solution</div><div class="p1"><br /></div><div class="p1"></div><div class="p1"><pre class="brush: bash">rngd -r /dev/urandom -o /dev/random -b -W 4096 -t 30<br /></pre></div><div class="p1"><br /></div><div class="p1">-r take random bits from /dev/urandom</div><div class="p1">-o output them to /dev/random</div><div class="p1">-b become a background daemon</div><div class="p1">-W fill up to 4096 bits (the max I think)</div><div class="p1">-t refresh every 30 seconds</div><div class="p1"><br /></div><div class="p1">To have that run on startup</div><div class="p1">edit</div><div class="p1"></div><div class="p1"><pre class="brush: bash">vi /etc/sysconfig/rngd<br /></pre></div><div class="p1"><br />Replace the EXTRAOPTIONS with<br /><br /></div><div class="p1"></div><div class="p1"><pre class="brush: bash">EXTRAOPTIONS="-r /dev/urandom -o /dev/random -b -W 4096 -t 30"<br /></pre></div><div class="p1"><br />Make sure rngd starts on each boot<br /><br /><pre class="brush: bash">chkconfig rngd on</pre><div class="p1"><br /></div></div><div class="p1">You should have no more delays now, adjust the refresh internal if there's problems.</div><div class="p1"><br /></div><h3>Note</h3><div>/dev/urandom isn't fully random (what is), when it runs out it just reuses what it has, /dev/random blocks when it runs out, hence the 'hanging'. &nbsp;But it solved my problem the sysadmin's can sort a proper solution for production.</div><div><br /></div><div>More on /dev/random <a href="http://en.wikipedia.org/wiki//dev/random" target="_blank">here</a></div>