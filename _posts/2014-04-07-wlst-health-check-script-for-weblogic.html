---
layout: post
title: WLST health check script for weblogic
date: '2014-04-07T20:43:00.003+01:00'
author: David
tags:
- wlst
- weblogic
modified_time: '2014-04-23T22:10:56.207+01:00'
blogger_id: tag:blogger.com,1999:blog-2027514548288128942.post-4891606805694147255
blogger_orig_url: http://davidkerwick.blogspot.com/2014/04/wlst-health-check-script-for-weblogic.html
---

A script that checks the 'health' of weblogic managed servers or admin server and restarts them if required.<br />For some reason on occasion I have noticed that the managed servers can have no health status, they are running so the node manager doesn't kick in and restart them, but the health status is unknown.<br /><br /><pre class="brush: python">#redirect wlst's own output to null, print lines in the script itself<br />redirect('/dev/null', 'false')<br /><br />connect(userConfigFile='/home/weblogic/user_projects/domains/my_domain/adminServerConfig.secure',<br />        userKeyFile='/home/weblogic/user_projects/domains/my_domain/adminServerKey.secure',<br />        url='t3://myhost.mydomain.ie:7001')<br /><br />servers = cmo.getServers()<br /><br />domainRuntime()<br />stoppedServers = []<br /><br />for server in servers:<br />    try:<br />        cd('/ServerRuntimes/' + server.getName())<br />        currentState = get('HealthState').getState()<br />        if currentState == 0:<br />            print server.getName() + ': ' + get('State') + ': HEALTH_OK'<br />        elif currentState == 1:<br />            print server.getName() + ': ' + get('State') + ': HEALTH_WARN'<br />        elif currentState == 2:<br />            print server.getName() + ': ' + get('State') + ': HEALTH_CRITICAL'<br />            stoppedServers.append(server.getName())<br />        elif currentState == 3:<br />            print server.getName() + ': ' + get('State') + ': HEALTH_FAILED'<br />            stoppedServers.append(server.getName())<br />        elif currentState == 4:<br />            print server.getName() + ': ' + get('State') + ': HEALTH_OVERLOADED'<br />        else:<br />            print server.getName() + ': ' + get('State') + ': UNKNOWN HEALTH STATE (' + currentState + ')'<br /><br />    except WLSTException, e:<br />        print server.getName() + " is not running."<br />        stoppedServers.append(server.getName())<br /><br />disconnect()<br /><br />if stoppedServers:<br />    print "Found stopped servers first one is " + stoppedServers[0]<br />    #If you want to email info on the failed server (probably a good idea) and are on Linux you can do something like this<br />    #os.system('echo "Auto restarting failed server: %s" | /bin/mailx -s  "WARNING: Auto restart failed server" system@mydomain.ie' % stoppedServers[0])<br />    nmConnect(userConfigFile='/home/weblogic/user_projects/domains/my_domain/nodemanagerConfig.secure',<br />              userKeyFile='/home/weblogic/user_projects/domains/my_domain/nodemanagerKey.secure',<br />              host='myhost.mydomain.ie', port='5556', domainName='my_domain',<br />              domainDir='/home/weblogic/user_projects/domains/my_domain/', nmType='plain')<br /><br />    runningStatus = nmServerStatus(stoppedServers[0])<br />    print 'Server ' + stoppedServers[0] + ' current running state is ' + runningStatus<br /><br />    #turn redirect off, we want to see how the server kill and start goes<br />    redirect('/dev/null', 'true')<br />    #kill the server and start it again<br />    try:<br />        nmKill(stoppedServers[0])<br />    except WLSTException, e:<br />        print 'Could not kill server, it may not have been running '<br /><br />    print 'Starting server \'' + stoppedServers[0] + '\' using nodemanager '<br />    nmStart(stoppedServers[0])<br /><br />exit()<br /></pre><br />