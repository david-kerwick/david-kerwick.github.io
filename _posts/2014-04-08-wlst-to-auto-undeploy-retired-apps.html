---
layout: post
title: WLST to auto undeploy retired apps
date: '2014-04-08T22:04:00.001+01:00'
author: David
tags:
- wlst
- weblogic
modified_time: '2014-04-23T22:10:56.210+01:00'
blogger_id: tag:blogger.com,1999:blog-2027514548288128942.post-7790910204850999058
blogger_orig_url: http://davidkerwick.blogspot.com/2014/04/wlst-to-auto-undeploy-retired-apps.html
---

So something that annoys me is having to clean up retired applications, I generally discover them because the deploy fails as the retired app is still present.<br />Of course I should check beforehand and remove it etc... but I prefer to run the below script first thing in the morning. &nbsp;There should be no deployments that need to be rolled back to the retired version as they should have been well discovered.<br /><br /><br /><pre class="brush: python">import os<br /><br />def check_app_status(appName, serverName):<br />    cd('domainRuntime:/AppRuntimeStateRuntime/AppRuntimeStateRuntime')<br />    currentState = cmo.getCurrentState(appName, serverName)<br />    return currentState<br /><br /><br />def undeploy_app(appName):<br />    print 'Undeploying ' + appName<br />    stopApplication(appName, targets='my-cluster')<br />    undeploy(appName, targets='my-cluster')<br /><br />#redirect wlst's own output to null, print lines in the script itself<br />redirect('/dev/null', 'false')<br /><br />connect(userConfigFile='/home/weblogic/user_projects/domains/my_domain/adminServerConfig.secure',<br />        userKeyFile='/home/weblogic/user_projects/domains/my_domain/adminServerKey.secure',<br />        url='t3://myhost.mydomain.ie:7001')<br />cd('AppDeployments')<br />appList = ls(returnMap='true')<br />for appName in appList:<br />    currentAppStatus = check_app_status(appName, 'my-cluster')<br />    if currentAppStatus == 'STATE_RETIRED':<br />        print 'Found a retired app ' + appName<br />        #email that the script has taken an action<br />        os.system(<br />            'echo "Auto undeploy retired app %s" | /bin/mailx -s  "INFO: Auto undeploy retired application" system@mydomain.ie' % appName)<br />        undeploy_app(appName)<br />    elif currentAppStatus == 'STATE_ACTIVE':<br />        print 'App is running ' + appName<br />    else:<br />        print 'App is not in one of the running state App: ' + appName + ' State: ' + currentAppStatus<br />        #Could email a warning here as well if the likes of prepared states are not desired on the likes of production etc...<br /><br />disconnect()<br />exit()<br /><br /><br /></pre>