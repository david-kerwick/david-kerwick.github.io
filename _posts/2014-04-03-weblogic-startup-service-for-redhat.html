---
layout: post
title: Weblogic startup service for RedHat
date: '2014-04-03T22:58:00.002+01:00'
author: David
tags:
- weblogic
modified_time: '2014-04-23T22:09:55.719+01:00'
blogger_id: tag:blogger.com,1999:blog-2027514548288128942.post-3498260207170789428
blogger_orig_url: http://davidkerwick.blogspot.com/2014/04/weblogic-startup-service-for-redhat.html
---

I want to create a startup service for Weblogic on RedHat so that when the machine started all the Weblogic components I wanted would be started. So that's the nodemanager, the AdminServer and the servers in the dynamic cluster.<br /><br />What I ended up with was an init.d script and a set of wlst scripts for starting and stopped the various components.<br /><br />First create the init.d script<br /><br /><pre class="brush: bash">cd /etc/init.d<br />vi nodemgr<br /></pre><div class="p1"><br />Add the following contents</div><br /><pre class="brush: bash">#!/bin/sh<br />#<br /># nodemgr Oracle Weblogic service<br />#<br /># chkconfig:   345 85 15<br /># description: Oracle Weblogic service<br /><br />### BEGIN INIT INFO<br /># Provides: nodemgr<br /># Required-Start: $network $local_fs<br /># Required-Stop:<br /># Should-Start:<br /># Should-Stop:<br /># Default-Start: 3 4 5<br /># Default-Stop: 0 1 2 6<br /># Short-Description: Oracle Weblogic service.<br /># Description: Starts and stops Oracle Weblogic NodeManager, Adminserver and Cluster.<br />### END INIT INFO<br /><br />. /etc/rc.d/init.d/functions<br /><br />DOMAIN_HOME="/home/weblogic/user_projects/domains/my_domain"<br />WLS_HOME="/home/weblogic/Oracle/Middleware/Oracle_Home"<br />DAEMON_USER="weblogic"<br />PROCESS_STRING="^.*${DOMAIN_HOME}.*weblogic.NodeManager.*"<br />LOG=${DOMAIN_HOME}/daemon_nodemanager.log<br />/bin/su ${DAEMON_USER} -c "source ${WLS_HOME}/wlserver/server/bin/setWLSEnv.sh 2&gt;&amp;1 &gt;&gt; ${LOG}"<br /><br />PROGRAM="${DOMAIN_HOME}/bin/startNodeManager.sh"<br />SERVICE_NAME=`/bin/basename $0`<br />LOCKFILE="/var/lock/subsys/${SERVICE_NAME}"<br /><br />RETVAL=0<br /><br />wait_for() {<br />    res=0<br />    COUNTER=0<br />    while [ ! ${res} -gt 0 ] &amp;&amp; [ ${COUNTER} -lt 20 ]<br />    do<br />        res=$(tail -5 "$2" | fgrep -c "$1")<br />        let COUNTER=COUNTER+1<br />        sleep 1<br />    done<br />    if [ ${COUNTER} -ge 20 ]; then<br />        echo "Didn't find $1 within the timeout"<br />    else<br />        echo "Found $1"<br />    fi<br />   <br />}<br /><br />startAdminServer(){<br />  /bin/su ${DAEMON_USER} -c "echo 'Starting Weblogic AdminServer on $(date)' | tee -a ${LOG}"<br />        /bin/su ${DAEMON_USER} -c "${WLS_HOME}/oracle_common/common/bin/wlst.sh /home/weblogic/user_projects/domains/my_domain/startAdminServer.py 2&gt;&amp;1 | tee -a ${LOG}"<br />        export -f wait_for<br />        /bin/su ${DAEMON_USER} -c "wait_for 'Successfully started server AdminServer' '${LOG}'" 2&gt;&amp;1 | tee -a ${LOG}<br />}<br /><br />stopAdminServer(){<br />  /bin/su ${DAEMON_USER} -c "echo 'Stopping Weblogic AdminServer on $(date)' | tee -a ${LOG}"<br />        /bin/su ${DAEMON_USER} -c "${WLS_HOME}/oracle_common/common/bin/wlst.sh ${DOMAIN_HOME}/stopAdminServer.py 2&gt;&amp;1 | tee -a ${LOG}"<br />}<br /><br />startCluster(){<br />  /bin/su ${DAEMON_USER} -c "echo 'Starting Weblogic Cluster on $(date)' | tee -a ${LOG}"<br />        /bin/su ${DAEMON_USER} -c "${WLS_HOME}/oracle_common/common/bin/wlst.sh ${DOMAIN_HOME}/startCluster.py 2&gt;&amp;1 | tee -a ${LOG}"<br />}<br /><br />stopCluster(){<br />  /bin/su ${DAEMON_USER} -c "echo 'Stopping Weblogic Cluster on $(date)' | tee -a ${LOG}"<br />        /bin/su ${DAEMON_USER} -c "${WLS_HOME}/oracle_common/common/bin/wlst.sh ${DOMAIN_HOME}/stopCluster.py 2&gt;&amp;1 | tee -a ${LOG}"<br />}<br /><br />start() {<br />  /bin/su ${DAEMON_USER} -c "echo 'Starting all Weblogic on $(date)' | tee -a ${LOG}"<br />        OLDPID=`/usr/bin/pgrep -f ${PROCESS_STRING}`<br />        if [ ! -z "$OLDPID" ]; then<br />         /bin/su ${DAEMON_USER} -c "echo '${SERVICE_NAME} is already running (pid ${OLDPID}) !' | tee -a ${LOG}"<br />            exit<br />        fi<br />        /bin/su ${DAEMON_USER} -c "echo -n 'Starting ${SERVICE_NAME}: ' | tee -a ${LOG}"<br />        /bin/su ${DAEMON_USER} -c "${PROGRAM} 2&gt;&amp;1 | tee -a $LOG &amp;"<br />        export -f wait_for<br />        /bin/su ${DAEMON_USER} -c "wait_for 'Plain socket listener started on port 5556' '${LOG}'" 2&gt;&amp;1 | tee -a ${LOG}<br />        #store the error code of the last command<br />        RETVAL=$?<br />        startAdminServer<br />        startCluster   <br />        #if the return value is success touch the lock file<br />        echo<br />        [ ${RETVAL} -eq 0 ] &amp;&amp; touch ${LOCKFILE}<br />        return ${RETVAL}<br />}<br /><br />stop() {<br /><br />        stopCluster<br />        stopAdminServer<br />        echo -n "Stopping ${SERVICE_NAME}: "<br /><br />        OLDPID=`/usr/bin/pgrep -f ${PROCESS_STRING}`<br />        if [ "$OLDPID" != "" ]; then<br />            /bin/kill -TERM ${OLDPID}<br />        else<br />            /bin/echo "${SERVICE_NAME} is stopped"<br />        fi<br />        RETVAL=$?<br />        echo<br />        [ ${RETVAL} -eq 0 ] &amp;&amp; rm -f ${LOCKFILE}<br />        return ${RETVAL}<br /><br />}<br /><br />restart() {<br />        stop<br />        sleep 10<br />        start<br />}<br /><br />case "$1" in<br />  start)<br />        start &amp;<br />        ;;<br />  stop)<br />        stop &amp;<br />        ;;<br />  restart|force-reload|reload)<br />        restart &amp;<br />        ;;<br />  condrestart|try-restart)<br />        [ -f ${LOCKFILE} ] &amp;&amp; restart<br />        ;;<br />  status)<br />        OLDPID=`/usr/bin/pgrep -f ${PROCESS_STRING}`<br />        if [ "${OLDPID}" != "" ]; then<br />            /bin/echo "${SERVICE_NAME} is running (pid: ${OLDPID})"<br />        else<br />            /bin/echo "${SERVICE_NAME} is stopped"<br />        fi<br />        RETVAL=$?<br />        ;;<br />  startAdminServer)<br />        startAdminServer &amp;<br />        ;;<br />  stopAdminServer)<br />        stopAdminServer &amp;<br />        ;;<br />  startCluster)<br />        startCluster &amp;<br />        ;;<br />  stopCluster)<br />        stopCluster &amp;<br />        ;;<br />  *)<br />        echo $"Usage: $0 {start|stop|status|restart|reload|force-reload|condrestart|startAdminServer|stopAdminServer|startCluster|stopCluster}"<br />        exit 1<br />esac<br /><br />exit ${RETVAL}<br /><br /><br /></pre>You need to make the script executable<br /><br /><pre class="brush: bash">chmod +x nodemgr<br /></pre><div class="p1"><br />And you need it to run on startup<br /><br /></div><pre class="brush: bash">chkconfig nodemgr on<br /></pre><br />This references several scripts that are place in the domain home which in this case is<br /><pre class="brush: bash">/home/weblogic/user_projects/domains/my_domain</pre><br />The scripts are<br /><br />startAdminServer.py<br /><pre class="brush: bash">if __name__ == '__main__': <br />    from wlstModule import * <br />    <br />nmConnect(userConfigFile='/home/weblogic/user_projects/domains/my_domain/nodemanagerConfig.secure', userKeyFile='/home/weblogic/user_projects/domains/my_domain/nodemanagerKey.secure', host='myhost.mydomain.ie', port='5556', domainName='my_domain', domainDir='/home/weblogic/user_projects/domains/my_domain/', nmType='plain')<br /><br />nmStart('AdminServer') <br /><br />exit()<br /></pre><br /><br />stopAdminServer.py<br /><pre class="brush: bash">if __name__ == '__main__': <br />    from wlstModule import *  <br />  <br />try:  <br />    connect(userConfigFile='/home/weblogic/user_projects/domains/my_domain/adminServerConfig.secure', userKeyFile='/home/weblogic/user_projects/domains/my_domain/adminServerKey.secure', url='t3://myhost.mydomain.ie:7001')<br />    shutdown()<br />    disconnect()<br />except WLSTException,e:<br />    print 'Could not shutdown admin server, attempting to kill it'<br />    nmConnect(userConfigFile='/home/weblogic/user_projects/domains/my_domain/nodemanagerConfig.secure', userKeyFile='/home/weblogic/user_projects/domains/my_domain/nodemanagerKey.secure', host='myhost.mydomain.ie', port='5556', domainName='my_domain', domainDir='/home/weblogic/user_projects/domains/my_domain/', nmType='plain')<br />    nmKill('AdminServer')<br />    disconnect()<br /><br />exit()<br /><br /></pre><br /><br />startCluster.py<br /><pre class="brush: bash">if __name__ == '__main__': <br />    from wlstModule import *<br />    <br />connect(userConfigFile='/home/weblogic/user_projects/domains/my_domain/adminServerConfig.secure', userKeyFile='/home/weblogic/user_projects/domains/my_domain/adminServerKey.secure', url='t3://myhost.mydomain.ie:7001')<br /><br />start('my-cluster', 'Cluster')<br /><br />exit()<br /></pre><br /><br />stopCluster.py<br /><pre class="brush: bash">if __name__ == '__main__': <br />    from wlstModule import *<br />    <br />connect(userConfigFile='/home/weblogic/user_projects/domains/my_domain/adminServerConfig.secure', userKeyFile='/home/weblogic/user_projects/domains/my_domain/adminServerKey.secure', url='t3://myhost.mydomain.ie:7001')<br /><br />shutdown('my-cluster', 'Cluster')<br /><br />exit()<br /><br /></pre><br /><br />