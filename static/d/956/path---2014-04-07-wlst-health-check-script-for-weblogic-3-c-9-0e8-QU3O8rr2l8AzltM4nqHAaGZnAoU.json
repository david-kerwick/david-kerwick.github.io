{"data":{"site":{"siteMetadata":{"title":"Random Stuff About Stuff","author":"David Kerwick"}},"markdownRemark":{"id":"b951f41a-5c4c-5b51-a312-b01b3f89d520","excerpt":"A script that checks the ‘health’ of weblogic managed servers or admin server and restarts them if required. For some reason on occasion I have noticed that the…","html":"<p>A script that checks the ‘health’ of weblogic managed servers or admin server and restarts them if required.<br>\nFor some reason on occasion I have noticed that the managed servers can have no health status, they are running so the node manager doesn’t kick in and restart them, but the health status is unknown.  </p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token comment\">#redirect wlst's own output to null, print lines in the script itself  </span>\nredirect<span class=\"token punctuation\">(</span><span class=\"token string\">'/dev/null'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'false'</span><span class=\"token punctuation\">)</span>  \n\nconnect<span class=\"token punctuation\">(</span>userConfigFile<span class=\"token operator\">=</span><span class=\"token string\">'/home/weblogic/user_projects/domains/my_domain/adminServerConfig.secure'</span><span class=\"token punctuation\">,</span>  \n userKeyFile<span class=\"token operator\">=</span><span class=\"token string\">'/home/weblogic/user_projects/domains/my_domain/adminServerKey.secure'</span><span class=\"token punctuation\">,</span>  \n url<span class=\"token operator\">=</span><span class=\"token string\">'t3://myhost.mydomain.ie:7001'</span><span class=\"token punctuation\">)</span>  \n\nservers <span class=\"token operator\">=</span> cmo<span class=\"token punctuation\">.</span>getServers<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>  \n\ndomainRuntime<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>  \nstoppedServers <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>  \n\n<span class=\"token keyword\">for</span> server <span class=\"token keyword\">in</span> servers<span class=\"token punctuation\">:</span>  \n <span class=\"token keyword\">try</span><span class=\"token punctuation\">:</span>  \n cd<span class=\"token punctuation\">(</span><span class=\"token string\">'/ServerRuntimes/'</span> <span class=\"token operator\">+</span> server<span class=\"token punctuation\">.</span>getName<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>  \n currentState <span class=\"token operator\">=</span> get<span class=\"token punctuation\">(</span><span class=\"token string\">'HealthState'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>getState<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>  \n <span class=\"token keyword\">if</span> currentState <span class=\"token operator\">==</span> <span class=\"token number\">0</span><span class=\"token punctuation\">:</span>  \n <span class=\"token keyword\">print</span> server<span class=\"token punctuation\">.</span>getName<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token string\">': '</span> <span class=\"token operator\">+</span> get<span class=\"token punctuation\">(</span><span class=\"token string\">'State'</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token string\">': HEALTH_OK'</span>  \n <span class=\"token keyword\">elif</span> currentState <span class=\"token operator\">==</span> <span class=\"token number\">1</span><span class=\"token punctuation\">:</span>  \n <span class=\"token keyword\">print</span> server<span class=\"token punctuation\">.</span>getName<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token string\">': '</span> <span class=\"token operator\">+</span> get<span class=\"token punctuation\">(</span><span class=\"token string\">'State'</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token string\">': HEALTH_WARN'</span>  \n <span class=\"token keyword\">elif</span> currentState <span class=\"token operator\">==</span> <span class=\"token number\">2</span><span class=\"token punctuation\">:</span>  \n <span class=\"token keyword\">print</span> server<span class=\"token punctuation\">.</span>getName<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token string\">': '</span> <span class=\"token operator\">+</span> get<span class=\"token punctuation\">(</span><span class=\"token string\">'State'</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token string\">': HEALTH_CRITICAL'</span>  \n stoppedServers<span class=\"token punctuation\">.</span>append<span class=\"token punctuation\">(</span>server<span class=\"token punctuation\">.</span>getName<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>  \n <span class=\"token keyword\">elif</span> currentState <span class=\"token operator\">==</span> <span class=\"token number\">3</span><span class=\"token punctuation\">:</span>  \n <span class=\"token keyword\">print</span> server<span class=\"token punctuation\">.</span>getName<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token string\">': '</span> <span class=\"token operator\">+</span> get<span class=\"token punctuation\">(</span><span class=\"token string\">'State'</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token string\">': HEALTH_FAILED'</span>  \n stoppedServers<span class=\"token punctuation\">.</span>append<span class=\"token punctuation\">(</span>server<span class=\"token punctuation\">.</span>getName<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>  \n <span class=\"token keyword\">elif</span> currentState <span class=\"token operator\">==</span> <span class=\"token number\">4</span><span class=\"token punctuation\">:</span>  \n <span class=\"token keyword\">print</span> server<span class=\"token punctuation\">.</span>getName<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token string\">': '</span> <span class=\"token operator\">+</span> get<span class=\"token punctuation\">(</span><span class=\"token string\">'State'</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token string\">': HEALTH_OVERLOADED'</span>  \n <span class=\"token keyword\">else</span><span class=\"token punctuation\">:</span>  \n <span class=\"token keyword\">print</span> server<span class=\"token punctuation\">.</span>getName<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token string\">': '</span> <span class=\"token operator\">+</span> get<span class=\"token punctuation\">(</span><span class=\"token string\">'State'</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token string\">': UNKNOWN HEALTH STATE ('</span> <span class=\"token operator\">+</span> currentState <span class=\"token operator\">+</span> <span class=\"token string\">')'</span>  \n\n <span class=\"token keyword\">except</span> WLSTException<span class=\"token punctuation\">,</span> e<span class=\"token punctuation\">:</span>  \n <span class=\"token keyword\">print</span> server<span class=\"token punctuation\">.</span>getName<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token string\">\" is not running.\"</span>  \n stoppedServers<span class=\"token punctuation\">.</span>append<span class=\"token punctuation\">(</span>server<span class=\"token punctuation\">.</span>getName<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>  \n\ndisconnect<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>  \n\n<span class=\"token keyword\">if</span> stoppedServers<span class=\"token punctuation\">:</span>  \n <span class=\"token keyword\">print</span> <span class=\"token string\">\"Found stopped servers first one is \"</span> <span class=\"token operator\">+</span> stoppedServers<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span>  \n <span class=\"token comment\">#If you want to email info on the failed server (probably a good idea) and are on Linux you can do something like this  </span>\n <span class=\"token comment\">#os.system('echo \"Auto restarting failed server: %s\" | /bin/mailx -s \"WARNING: Auto restart failed server\" system@mydomain.ie' % stoppedServers[0])  </span>\n nmConnect<span class=\"token punctuation\">(</span>userConfigFile<span class=\"token operator\">=</span><span class=\"token string\">'/home/weblogic/user_projects/domains/my_domain/nodemanagerConfig.secure'</span><span class=\"token punctuation\">,</span>  \n userKeyFile<span class=\"token operator\">=</span><span class=\"token string\">'/home/weblogic/user_projects/domains/my_domain/nodemanagerKey.secure'</span><span class=\"token punctuation\">,</span>  \n host<span class=\"token operator\">=</span><span class=\"token string\">'myhost.mydomain.ie'</span><span class=\"token punctuation\">,</span> port<span class=\"token operator\">=</span><span class=\"token string\">'5556'</span><span class=\"token punctuation\">,</span> domainName<span class=\"token operator\">=</span><span class=\"token string\">'my_domain'</span><span class=\"token punctuation\">,</span>  \n domainDir<span class=\"token operator\">=</span><span class=\"token string\">'/home/weblogic/user_projects/domains/my_domain/'</span><span class=\"token punctuation\">,</span> nmType<span class=\"token operator\">=</span><span class=\"token string\">'plain'</span><span class=\"token punctuation\">)</span>  \n\n runningStatus <span class=\"token operator\">=</span> nmServerStatus<span class=\"token punctuation\">(</span>stoppedServers<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>  \n <span class=\"token keyword\">print</span> <span class=\"token string\">'Server '</span> <span class=\"token operator\">+</span> stoppedServers<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">+</span> <span class=\"token string\">' current running state is '</span> <span class=\"token operator\">+</span> runningStatus  \n\n <span class=\"token comment\">#turn redirect off, we want to see how the server kill and start goes  </span>\n redirect<span class=\"token punctuation\">(</span><span class=\"token string\">'/dev/null'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'true'</span><span class=\"token punctuation\">)</span>  \n <span class=\"token comment\">#kill the server and start it again  </span>\n <span class=\"token keyword\">try</span><span class=\"token punctuation\">:</span>  \n nmKill<span class=\"token punctuation\">(</span>stoppedServers<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>  \n <span class=\"token keyword\">except</span> WLSTException<span class=\"token punctuation\">,</span> e<span class=\"token punctuation\">:</span>  \n <span class=\"token keyword\">print</span> <span class=\"token string\">'Could not kill server, it may not have been running '</span>  \n\n <span class=\"token keyword\">print</span> <span class=\"token string\">'Starting server \\''</span> <span class=\"token operator\">+</span> stoppedServers<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">+</span> <span class=\"token string\">'\\' using nodemanager '</span>  \n nmStart<span class=\"token punctuation\">(</span>stoppedServers<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>  \n\nexit<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>  </code></pre></div>","frontmatter":{"title":"WLST health check script for weblogic","date":"April 07, 2014"}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/2014-04-07-wlst-health-check-script-for-weblogic/","previous":{"fields":{"slug":"/2014-04-07-problem-with-cmo-object-in-wlst-script/"},"frontmatter":{"title":"Problem with cmo object in wlst script"}},"next":{"fields":{"slug":"/2014-04-07-weblogic-out-of-permgen/"},"frontmatter":{"title":"Weblogic out of permgen "}}}}