{"data":{"site":{"siteMetadata":{"title":"Random Stuff About Stuff","author":"David Kerwick"}},"markdownRemark":{"id":"f87692a4-94ff-53f5-8d9c-879a0d6cc95d","excerpt":"So more and more I seem to be looking for that command I typed before. The one with the secret magic sauce to get something to work, long winded Docker run…","html":"<p>So more and more I seem to be looking for that command I typed before. The one with the secret magic sauce to get something to work, long winded Docker run commands and such. And more and more it seems to be on another computer, if I’m on the laptop it’s on the desktop etc…</p>\n<p>To start with take two .zsh_history files and attempt to combine them before doing any scripts</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">cat</span> laptop/.zsh_history desktop/.zsh_history</code></pre></div>\n<p>Pretty basic but creates an odd ‘history’ it would be best to sort them. The first part of a .zsh_history file is a timestamp so it should be possible to neatly sort both files.</p>\n<p>oh-my-zsh seems to have the history command aliased and only shows line numbers.  To see the date stamps bypassed the alias with a backslash</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">\\history -E</code></pre></div>\n<p>So to sort the combination of both files pipe is to sort</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">cat</span> laptop/.zsh_history desktop/.zsh_history <span class=\"token operator\">|</span> <span class=\"token function\">sort</span></code></pre></div>\n<p>Depending on your history you might get the error</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">sort: string comparison failed: Illegal byte sequence\nsort: Set LC_ALL<span class=\"token operator\">=</span><span class=\"token string\">'C'</span> to work around the problem.</code></pre></div>\n<p>You can set that option inline which might be handier for this</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">cat</span> laptop/.zsh_history desktop/.zsh_history <span class=\"token operator\">|</span> LC_ALL<span class=\"token operator\">=</span>C <span class=\"token function\">sort</span></code></pre></div>\n<p>Getting there, the problem now will be the above has messed up multiline commands, they have been sorted into there seperate lines.</p>\n<p>Now it depends how much you want your multiline history I guess, I didn’t like the idea that I’d lose things if I merged and sorted like above.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">cat</span> laptop/.zsh_history desktop/.zsh_history <span class=\"token operator\">|</span> <span class=\"token function\">awk</span> <span class=\"token string\">'{if (sub(/\\\\$/,\"RRRRR\")) printf \"%s\", <span class=\"token variable\">$0</span>; else print <span class=\"token variable\">$0</span>}'</span> <span class=\"token operator\">|</span> LC_ALL<span class=\"token operator\">=</span>C <span class=\"token function\">sort</span> -u <span class=\"token operator\">|</span> <span class=\"token function\">awk</span> <span class=\"token string\">'{gsub(/RRRRR/,\"\\\\\\n\"); print <span class=\"token variable\">$0</span>}'</span></code></pre></div>\n<p>So quick summary combine both files as before, use awk to turn the multi line history into a single line, sort that, use awk again to change the multi line history back.</p>\n<p>You need to pick a temporary character sequence that won’t appear in your history for the multi line work around, “RRRRR” in the example.</p>\n<p>But this means that the above line itself will have weird things done to it in the history. So a variable would be best, you can put one in a script if you are running it as a cron.  Or you could stamp it inline something like this.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">cat</span> laptop/.zsh_history desktop/.zsh_history <span class=\"token operator\">|</span> <span class=\"token function\">awk</span> -v date<span class=\"token operator\">=</span><span class=\"token string\">\"WILL_NOT_APPEAR<span class=\"token variable\"><span class=\"token variable\">$(</span><span class=\"token function\">date</span> +<span class=\"token string\">\"%s\"</span><span class=\"token variable\">)</span></span>\"</span> <span class=\"token string\">'{if (sub(/\\\\$/,date)) printf \"%s\", <span class=\"token variable\">$0</span>; else print <span class=\"token variable\">$0</span>}'</span> <span class=\"token operator\">|</span> LC_ALL<span class=\"token operator\">=</span>C <span class=\"token function\">sort</span> -u <span class=\"token operator\">|</span> <span class=\"token function\">awk</span> -v date<span class=\"token operator\">=</span><span class=\"token string\">\"WILL_NOT_APPEAR<span class=\"token variable\"><span class=\"token variable\">$(</span><span class=\"token function\">date</span> +<span class=\"token string\">\"%s\"</span><span class=\"token variable\">)</span></span>\"</span> <span class=\"token string\">'{gsub('</span><span class=\"token function\">date</span><span class=\"token string\">',\"\\\\\\n\"); print <span class=\"token variable\">$0</span>}'</span></code></pre></div>\n<p>Once you are happy with the output you can then pipe the results to a file by adding <code class=\"language-text\">&gt; your_file.txt</code> to the end.</p>\n<p>And finally cp / mv that file to your .zsh_history</p>\n<p>One possible gotcha when I was testing this. Lines started being removed from the .zsh_history file, so I thought the sort was doing mad things.  In fact I just breached the HISTSIZE limit and zsh was trimming the file. So probably worth increasing that by a multiple of the number of computers you are syncing.</p>","frontmatter":{"title":"Combining zsh history files","date":"January 04, 2017"}}},"pageContext":{"slug":"/2017-01-04-combining-zsh-history-files/","previous":{"fields":{"slug":"/2017-01-04-per-domain-dns-and-reverse-dns-on-a-mac/"},"frontmatter":{"title":"Per Domain DNS and reverse DNS on a Mac"}},"next":{"fields":{"slug":"/2017-01-04-moving-to-jekyll-3x/"},"frontmatter":{"title":"Moving to Jekyll 3.x"}}}}