{"data":{"site":{"siteMetadata":{"title":"Random Stuff About Stuff","author":"David Kerwick"}},"markdownRemark":{"id":"81aec4bc-f163-5039-933e-f0bc90ac805f","excerpt":"So something that annoys me is having to clean up retired applications, I generally discover them because the deploy fails as the retired app is still present…","html":"<p>So something that annoys me is having to clean up retired applications, I generally discover them because the deploy fails as the retired app is still present.<br>\nOf course I should check beforehand and remove it etc… but I prefer to run the below script first thing in the morning.  There should be no deployments that need to be rolled back to the retired version as any problems should have been well discovered.  </p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">import</span> os  \n\n<span class=\"token keyword\">def</span> <span class=\"token function\">check_app_status</span><span class=\"token punctuation\">(</span>appName<span class=\"token punctuation\">,</span> serverName<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>  \n cd<span class=\"token punctuation\">(</span><span class=\"token string\">'domainRuntime:/AppRuntimeStateRuntime/AppRuntimeStateRuntime'</span><span class=\"token punctuation\">)</span>  \n currentState <span class=\"token operator\">=</span> cmo<span class=\"token punctuation\">.</span>getCurrentState<span class=\"token punctuation\">(</span>appName<span class=\"token punctuation\">,</span> serverName<span class=\"token punctuation\">)</span>  \n <span class=\"token keyword\">return</span> currentState  \n\n<span class=\"token keyword\">def</span> <span class=\"token function\">undeploy_app</span><span class=\"token punctuation\">(</span>appName<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>  \n <span class=\"token keyword\">print</span> <span class=\"token string\">'Undeploying '</span> <span class=\"token operator\">+</span> appName  \n stopApplication<span class=\"token punctuation\">(</span>appName<span class=\"token punctuation\">,</span> targets<span class=\"token operator\">=</span><span class=\"token string\">'my-cluster'</span><span class=\"token punctuation\">)</span>  \n undeploy<span class=\"token punctuation\">(</span>appName<span class=\"token punctuation\">,</span> targets<span class=\"token operator\">=</span><span class=\"token string\">'my-cluster'</span><span class=\"token punctuation\">)</span>  \n\n<span class=\"token comment\">#redirect wlst's own output to null, print lines in the script itself  </span>\nredirect<span class=\"token punctuation\">(</span><span class=\"token string\">'/dev/null'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'false'</span><span class=\"token punctuation\">)</span>  \n\nconnect<span class=\"token punctuation\">(</span>userConfigFile<span class=\"token operator\">=</span><span class=\"token string\">'/home/weblogic/user_projects/domains/my_domain/adminServerConfig.secure'</span><span class=\"token punctuation\">,</span>  \n userKeyFile<span class=\"token operator\">=</span><span class=\"token string\">'/home/weblogic/user_projects/domains/my_domain/adminServerKey.secure'</span><span class=\"token punctuation\">,</span>  \n url<span class=\"token operator\">=</span><span class=\"token string\">'t3://myhost.mydomain.ie:7001'</span><span class=\"token punctuation\">)</span>  \ncd<span class=\"token punctuation\">(</span><span class=\"token string\">'AppDeployments'</span><span class=\"token punctuation\">)</span>  \nappList <span class=\"token operator\">=</span> ls<span class=\"token punctuation\">(</span>returnMap<span class=\"token operator\">=</span><span class=\"token string\">'true'</span><span class=\"token punctuation\">)</span>  \n<span class=\"token keyword\">for</span> appName <span class=\"token keyword\">in</span> appList<span class=\"token punctuation\">:</span>  \n currentAppStatus <span class=\"token operator\">=</span> check_app_status<span class=\"token punctuation\">(</span>appName<span class=\"token punctuation\">,</span> <span class=\"token string\">'my-cluster'</span><span class=\"token punctuation\">)</span>  \n <span class=\"token keyword\">if</span> currentAppStatus <span class=\"token operator\">==</span> <span class=\"token string\">'STATE_RETIRED'</span><span class=\"token punctuation\">:</span>  \n <span class=\"token keyword\">print</span> <span class=\"token string\">'Found a retired app '</span> <span class=\"token operator\">+</span> appName  \n <span class=\"token comment\">#email that the script has taken an action  </span>\n os<span class=\"token punctuation\">.</span>system<span class=\"token punctuation\">(</span>  \n <span class=\"token string\">'echo \"Auto undeploy retired app %s\" | /bin/mailx -s \"INFO: Auto undeploy retired application\" system@mydomain.ie'</span> <span class=\"token operator\">%</span> appName<span class=\"token punctuation\">)</span>  \n undeploy_app<span class=\"token punctuation\">(</span>appName<span class=\"token punctuation\">)</span>  \n <span class=\"token keyword\">elif</span> currentAppStatus <span class=\"token operator\">==</span> <span class=\"token string\">'STATE_ACTIVE'</span><span class=\"token punctuation\">:</span>  \n <span class=\"token keyword\">print</span> <span class=\"token string\">'App is running '</span> <span class=\"token operator\">+</span> appName  \n <span class=\"token keyword\">else</span><span class=\"token punctuation\">:</span>  \n <span class=\"token keyword\">print</span> <span class=\"token string\">'App is not in one of the running state App: '</span> <span class=\"token operator\">+</span> appName <span class=\"token operator\">+</span> <span class=\"token string\">' State: '</span> <span class=\"token operator\">+</span> currentAppStatus  \n <span class=\"token comment\">#Could email a warning here as well if the likes of prepared states are not desired on the likes of production etc...  </span>\n\ndisconnect<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>  \nexit<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>  </code></pre></div>","frontmatter":{"title":"WLST to auto undeploy retired apps","date":"April 08, 2014"}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/2014-04-08-wlst-to-auto-undeploy-retired-apps/","previous":{"fields":{"slug":"/2014-04-07-weblogic-out-of-permgen/"},"frontmatter":{"title":"Weblogic out of permgen "}},"next":{"fields":{"slug":"/2014-04-23-java-mission-control-and-weblogic/"},"frontmatter":{"title":"Java Mission Control and Weblogic Dynamic Server"}}}}