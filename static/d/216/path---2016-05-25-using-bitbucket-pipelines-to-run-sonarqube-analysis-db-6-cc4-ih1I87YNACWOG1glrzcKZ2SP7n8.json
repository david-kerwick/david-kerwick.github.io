{"data":{"site":{"siteMetadata":{"title":"Random Stuff About Stuff","author":"David Kerwick"}},"markdownRemark":{"id":"469a3043-5cfb-5b15-ad02-0295561b1efa","excerpt":"So Atlassian just announced  Bitbucket Pipelines  and they look really good so I signed up for the beta to give them a go. We have a SonarQube server set up and…","html":"<p>So Atlassian just announced <a href=\"http://blogs.atlassian.com/2016/05/introducing-bitbucket-pipelines-beta-continuous-delivery-built-within-bitbucket/\">Bitbucket Pipelines</a> and they look really good so I signed up for the beta to give them a go.</p>\n<p>We have a SonarQube server set up and had Jenkins configured to pick up from Bitbucket and run the analysis, works OK had also set up web hooks to prod Jenkins when there was a push.</p>\n<p>So there’s a few integrations already available but SonarQube isn’t one yet but the examples are worth looking at as they give you an idea of how to set up your own one.</p>\n<p>The <a href=\"https://confluence.atlassian.com/bitbucket/get-started-with-bitbucket-pipelines-792298921.html\">docs</a> cover the setup well. I found it worthwhile getting the simple echo to work.</p>\n<p>For the build of your branch they create a docker container, checkout your branch and then it’s pretty much up to you, very powerful I think.</p>\n<p>So you could create your own Docker image and have it on Docker Hub to pull down but for getting the sonar scanner working we can just use the scripting part of the yaml file.</p>\n<p>So in the <code class=\"language-text\">bitbucket-pipelines.yml</code> file</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">pipelines</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">default</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">step</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">script</span><span class=\"token punctuation\">:</span>\n          <span class=\"token punctuation\">-</span> echo \"Sonar pipeline<span class=\"token punctuation\">,</span> baby<span class=\"token tag\">!\"</span>\n          <span class=\"token punctuation\">-</span> curl <span class=\"token punctuation\">-</span><span class=\"token punctuation\">-</span>insecure <span class=\"token punctuation\">-</span>OL https<span class=\"token punctuation\">:</span>//sonarsource.bintray.com/Distribution/sonar<span class=\"token punctuation\">-</span>scanner<span class=\"token punctuation\">-</span>cli/sonar<span class=\"token punctuation\">-</span>scanner<span class=\"token punctuation\">-</span>2.6.1.zip\n          <span class=\"token punctuation\">-</span> unzip sonar<span class=\"token punctuation\">-</span>scanner<span class=\"token punctuation\">-</span>2.6.1.zip\n          <span class=\"token punctuation\">-</span> ./sonar<span class=\"token punctuation\">-</span>scanner<span class=\"token punctuation\">-</span>2.6.1/bin/sonar<span class=\"token punctuation\">-</span>scanner <span class=\"token punctuation\">-</span>Dsonar.host.url=https<span class=\"token punctuation\">:</span>//sonar.&lt;YOURSERVER<span class=\"token punctuation\">></span>.com <span class=\"token punctuation\">-</span>Dsonar.branch=$BITBUCKET_BRANCH</code></pre></div>\n<p>This sets up a default pipeline for all branches</p>\n<p>The script</p>\n<p>Echo’s something out at the start just to show it’s working</p>\n<p>Downloads the latest sonar scanner</p>\n<p>Unzips the scanner</p>\n<p>Then runs the scanner script, you need to pass in the location of your SonarQube server and use the provided <code class=\"language-text\">$BITBUCKET_BRANCH</code> environment variable to pass sonar the branch name.</p>\n<p>And well that’s it, pretty simple and awesome if you ask me. It also seems to run really quick at the moment.</p>\n<p>You can going into the pipeline section on the bitbucket console you see what’s happening and even click into the detail of that to see live running logs of the container and your scripts running</p>\n<p>\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/ee692b7af9392cd6ab114affa5f57de5/83960/pipeline_shot.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 23.375363724539284%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAABYlAAAWJQFJUiTwAAAA9ElEQVQY012PgU6DMBRF+RKnkWVMYFAKhNGhc/v7/ccIYuLoxIjScn0rxEybnLwXQg8H63gs0ZQHDL3El1Yo31/Qqg9IeQYXe3jxBqv0ETMnxGxBOGyc/7ghbp0IlpQN2raFUgrX59RIxGIHn4Q8f0aQFiQu4PKcLoa4W06YnU2ThPWpxSvR970Raa3NbIxwDyfMwNZbhNkTWLY1rJICHhdUL8wH/WTE5RtYb+dPdN891CTSw/Ar5PnOvBhR4UUa0K9fmPsJ7t0Itsdhu5z2EduLYVVVhbqu0XXd30IpTdUiSE3FkmV4YOuxytTkY2ksrp4J/AD1wu3UERQWKAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"Pipeline Shot\"\n        title=\"\"\n        src=\"/static/ee692b7af9392cd6ab114affa5f57de5/b9e4f/pipeline_shot.png\"\n        srcset=\"/static/ee692b7af9392cd6ab114affa5f57de5/cf440/pipeline_shot.png 148w,\n/static/ee692b7af9392cd6ab114affa5f57de5/d2d38/pipeline_shot.png 295w,\n/static/ee692b7af9392cd6ab114affa5f57de5/b9e4f/pipeline_shot.png 590w,\n/static/ee692b7af9392cd6ab114affa5f57de5/f9b6a/pipeline_shot.png 885w,\n/static/ee692b7af9392cd6ab114affa5f57de5/2d849/pipeline_shot.png 1180w,\n/static/ee692b7af9392cd6ab114affa5f57de5/bbefa/pipeline_shot.png 1770w,\n/static/ee692b7af9392cd6ab114affa5f57de5/83960/pipeline_shot.png 2062w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<p>You can expand each section as well to get more details.</p>\n<p>I think they have nailed it with Pipelines, of course no idea of the pricing yet, but for now I’m very impressed.</p>","frontmatter":{"title":"Using Bitbucket Pipelines to run Sonarqube analysis","date":"May 25, 2016"}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/2016-05-25-using-bitbucket-pipelines-to-run-sonarqube-analysis/","previous":{"fields":{"slug":"/2016-05-04-using-gulp-to-pull-in-only-the-needed-bower-assests/"},"frontmatter":{"title":"Using Gulp to pull in only the needed bower assets"}},"next":{"fields":{"slug":"/2017-01-04-why-are-there-asterisks-beside-some-lines-in-zshhistory/"},"frontmatter":{"title":"Why are there asterisks beside some lines in .zsh_history"}}}}