{"data":{"site":{"siteMetadata":{"title":"Random Stuff About Stuff","author":"David Kerwick"}},"markdownRemark":{"id":"2ab13029-77f4-565e-86ff-fc7ac2b2a725","excerpt":"Continuing my little series of posts on using wlst,  how to create a domain  and  how to add a machine  the below will set up a dynamic server cluster.  This is…","html":"<p>Continuing my little series of posts on using wlst, <a href=\"../2014-03-19-create-new-weblogic-domain-using-wlst\">how to create a domain</a> and <a href=\"../2014-03-20-create-machine-for-weblogic-with-wlst\">how to add a machine</a> the below will set up a dynamic server cluster.  This is a new feature for Weblogic 12C 12.1.2.  </p>\n<p>You can find more details on the dynamic cluster <a href=\"http://docs.oracle.com/middleware/1212/wls/INTRO/clustering.htm#BABJGIBI\">here</a>.  In brief it allows you to grow and shrink the number of available managed servers, with each managed server based on a template.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">if</span> __name__ <span class=\"token operator\">==</span> <span class=\"token string\">'__main__'</span><span class=\"token punctuation\">:</span>  \n    <span class=\"token keyword\">from</span> wlstModule <span class=\"token keyword\">import</span> <span class=\"token operator\">*</span>  \n\nconnect<span class=\"token punctuation\">(</span><span class=\"token string\">'weblogic'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'weblogic1'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'t3://myhost.mydomain.ie:7001'</span><span class=\"token punctuation\">)</span>  \nedit<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>  \nstartEdit<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>  \n\ndynamicServerTemplate <span class=\"token operator\">=</span> cmo<span class=\"token punctuation\">.</span>createServerTemplate<span class=\"token punctuation\">(</span><span class=\"token string\">'my-server-template'</span><span class=\"token punctuation\">)</span>  \ndynamicServerTemplate<span class=\"token punctuation\">.</span>setAcceptBacklog<span class=\"token punctuation\">(</span><span class=\"token number\">2000</span><span class=\"token punctuation\">)</span>  \ndynamicServerTemplate<span class=\"token punctuation\">.</span>setAutoRestart<span class=\"token punctuation\">(</span>true<span class=\"token punctuation\">)</span>  \ndynamicServerTemplate<span class=\"token punctuation\">.</span>setRestartMax<span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span>  \ndynamicServerTemplate<span class=\"token punctuation\">.</span>setStartupTimeout<span class=\"token punctuation\">(</span><span class=\"token number\">600</span><span class=\"token punctuation\">)</span>  \ndynamicServerTemplate<span class=\"token punctuation\">.</span>setAutoKillIfFailed<span class=\"token punctuation\">(</span>true<span class=\"token punctuation\">)</span>  \ndynamicServerTemplate<span class=\"token punctuation\">.</span>getOverloadProtection<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>setFailureAction<span class=\"token punctuation\">(</span><span class=\"token string\">'force-shutdown'</span><span class=\"token punctuation\">)</span>  \ndynamicServerTemplate<span class=\"token punctuation\">.</span>getOverloadProtection<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>setPanicAction<span class=\"token punctuation\">(</span><span class=\"token string\">'system-exit'</span><span class=\"token punctuation\">)</span>  \n<span class=\"token comment\"># Set whatever settings best suit the memory on the system and what you what to do with this server  </span>\n<span class=\"token comment\">#I believe MaxPermSize should be half the max heap  </span>\n<span class=\"token comment\">#The urandom is covered in another post  </span>\ndynamicServerTemplate<span class=\"token punctuation\">.</span>getServerStart<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>setArguments<span class=\"token punctuation\">(</span>  \n    <span class=\"token string\">'-Xmx2048m -Xms2048m -XX:+UseG1GC -XX:MaxPermSize=1024m -Djava.security.egd=file:///dev/./urandom'</span><span class=\"token punctuation\">)</span>  \ndynamicServerTemplate<span class=\"token punctuation\">.</span>getLog<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>setFileName<span class=\"token punctuation\">(</span><span class=\"token string\">'${serverName}_%yyyy%_%MM%_%dd%_%hhmm%.log'</span><span class=\"token punctuation\">)</span>  \ndynamicServerTemplate<span class=\"token punctuation\">.</span>getLog<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>setRotationType<span class=\"token punctuation\">(</span><span class=\"token string\">'byTime'</span><span class=\"token punctuation\">)</span>  \ndynamicServerTemplate<span class=\"token punctuation\">.</span>getLog<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>setRedirectStderrToServerLogEnabled<span class=\"token punctuation\">(</span>true<span class=\"token punctuation\">)</span>  \ndynamicServerTemplate<span class=\"token punctuation\">.</span>getLog<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>setRedirectStdoutToServerLogEnabled<span class=\"token punctuation\">(</span>true<span class=\"token punctuation\">)</span>  \ndynamicServerTemplate<span class=\"token punctuation\">.</span>getWebServer<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>getWebServerLog<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>setFileName<span class=\"token punctuation\">(</span><span class=\"token string\">'${serverName}_access_%yyyy%_%MM%_%dd%_%hhmm%.log'</span><span class=\"token punctuation\">)</span>  \ndynamicServerTemplate<span class=\"token punctuation\">.</span>getWebServer<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>getWebServerLog<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>setRotationType<span class=\"token punctuation\">(</span><span class=\"token string\">'byTime'</span><span class=\"token punctuation\">)</span>  \n\ndynCluster <span class=\"token operator\">=</span> cmo<span class=\"token punctuation\">.</span>createCluster<span class=\"token punctuation\">(</span><span class=\"token string\">'my-cluster'</span><span class=\"token punctuation\">)</span>  \ndynCluster<span class=\"token punctuation\">.</span>getOverloadProtection<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>setFailureAction<span class=\"token punctuation\">(</span><span class=\"token string\">'force-shutdown'</span><span class=\"token punctuation\">)</span>  \ndynCluster<span class=\"token punctuation\">.</span>getOverloadProtection<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>setPanicAction<span class=\"token punctuation\">(</span><span class=\"token string\">'system-exit'</span><span class=\"token punctuation\">)</span>  \ndynServers <span class=\"token operator\">=</span> dynCluster<span class=\"token punctuation\">.</span>getDynamicServers<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>  \ndynServers<span class=\"token punctuation\">.</span>setMaximumDynamicServerCount<span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span>  \ndynServers<span class=\"token punctuation\">.</span>setServerTemplate<span class=\"token punctuation\">(</span>dynamicServerTemplate<span class=\"token punctuation\">)</span>  \n\ndynServers<span class=\"token punctuation\">.</span>setServerNamePrefix<span class=\"token punctuation\">(</span><span class=\"token string\">'my-server-'</span><span class=\"token punctuation\">)</span>  \n\ndynServers<span class=\"token punctuation\">.</span>setCalculatedMachineNames<span class=\"token punctuation\">(</span>true<span class=\"token punctuation\">)</span>  \ndynServers<span class=\"token punctuation\">.</span>setCalculatedListenPorts<span class=\"token punctuation\">(</span>true<span class=\"token punctuation\">)</span>  \n\nactivate<span class=\"token punctuation\">(</span>block<span class=\"token operator\">=</span><span class=\"token string\">\"true\"</span><span class=\"token punctuation\">)</span>  \n\nexit<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>  </code></pre></div>\n<p>One thing worth mentioning a bit more is the log file names.<br>\nAs the servers an dynamically created based on the prefix, in this case my-server-1, my-server-2, etc… you can use a variable made available by Weblogic ${serverName} which will have this dynamically created name.<br>\nThe filepattern can be of your choosing and is used when the log files are rotated, the pattern replaced with the actual date values.<br>\nSo for example the logs for my-server—1 would be<br>\n<code class=\"language-text\">my-server-1_yyyy_MM_dd_hhmm.log</code><br>\nBit of an eye full, but when rotated the old one becomes<br>\n<code class=\"language-text\">my-server-1_2014_03_20_0000.log</code><br>\nWhich I find better than the sequence number which is the default</p>","frontmatter":{"title":"Create a Weblogic dynamic server cluster using WLST","date":"March 20, 2014"}}},"pageContext":{"slug":"/2014-03-20-create-weblogic-dynamic-server-cluster/","previous":{"fields":{"slug":"/2014-03-20-create-machine-for-weblogic-with-wlst/"},"frontmatter":{"title":"Create a 'machine' for Weblogic with WLST"}},"next":{"fields":{"slug":"/2014-03-20-weblogic-linking-machine-and-cluster/"},"frontmatter":{"title":"Weblogic linking machine and cluster using WLST"}}}}