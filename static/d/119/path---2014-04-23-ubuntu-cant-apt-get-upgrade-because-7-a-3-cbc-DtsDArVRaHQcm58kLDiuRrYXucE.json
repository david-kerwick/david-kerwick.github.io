{"data":{"site":{"siteMetadata":{"title":"Random Stuff About Stuff","author":"David Kerwick"}},"markdownRemark":{"id":"9f2b8fba-a786-579d-a243-bceb7d34d7f1","excerpt":"When trying to do an upgrade I got the error below If you do a df you will probably see your boot partition is full. Freeing up space seems to be no fun, to…","html":"<p>When trying to do an upgrade I got the error below</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">sudo</span> <span class=\"token function\">apt-get</span> upgrade  \nReading package lists<span class=\"token punctuation\">..</span>. Done  \nBuilding dependency tree   \nReading state information<span class=\"token punctuation\">..</span>. Done  \nYou might want to run <span class=\"token string\">'apt-get -f install'</span> to correct these.  \nThe following packages have unmet dependencies:  \n linux-server <span class=\"token keyword\">:</span> Depends: linux-headers-server <span class=\"token punctuation\">(</span><span class=\"token operator\">=</span> 3.2.0.55.65<span class=\"token punctuation\">)</span> but 3.2.0.60.71 is installed  \n\nE: Unmet dependencies. Try using -f.  </code></pre></div>\n<div class=\"p1\">When you run sudo apt-get -f install as suggested you might get something like</div>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">sudo</span> <span class=\"token function\">apt-get</span> -f <span class=\"token function\">install</span>  \ngzip: stdout: No space left on device  \nE: mkinitramfs failure cpio 141 <span class=\"token function\">gzip</span> 1  \nupdate-initramfs: failed <span class=\"token keyword\">for</span> /boot/initrd.img-3.2.0-60-generic with 1.  \nrun-parts: /etc/kernel/postinst.d/initramfs-tools exited with <span class=\"token keyword\">return</span> code 1  \nFailed to process /etc/kernel/postinst.d at /var/lib/dpkg/info/linux-image-3.2.0-60-generic.postinst line 1010.  \ndpkg: error processing linux-image-3.2.0-60-generic <span class=\"token punctuation\">(</span>--configure<span class=\"token punctuation\">)</span>:  \n subprocess installed post-installation script returned error <span class=\"token keyword\">exit</span> status 2  \nSetting up linux-image-server <span class=\"token punctuation\">(</span>3.2.0.55.65<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">..</span>.  \nSetting up linux-headers-server <span class=\"token punctuation\">(</span>3.2.0.60.71<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">..</span>.  \ndpkg: dependency problems prevent configuration of linux-server:  \n linux-server depends on linux-headers-server <span class=\"token punctuation\">(</span><span class=\"token operator\">=</span> 3.2.0.55.65<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> however:  \n Version of linux-headers-server on system is 3.2.0.60.71.  \ndpkg: error processing linux-server <span class=\"token punctuation\">(</span>--configure<span class=\"token punctuation\">)</span>:  \n dependency problems - leaving unconfigured  \nNo apport report written because the error message indicates its a followup error from a previous failure.  \n Errors were encountered <span class=\"token keyword\">while</span> processing:  \n linux-image-3.2.0-60-generic  \n linux-server  \nE: Sub-process /usr/bin/dpkg returned an error code <span class=\"token punctuation\">(</span>1<span class=\"token punctuation\">)</span>  </code></pre></div>\n<p>If you do a df you will probably see your boot partition is full.</p>\n<p>Freeing up space seems to be no fun, to find the list of old images</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">sudo</span> dpkg --list <span class=\"token operator\">|</span> <span class=\"token function\">grep</span> linux-image  \n\nii linux-image-3.2.0-41-generic 3.2.0-41.66 Linux kernel image <span class=\"token keyword\">for</span> version 3.2.0 on 64 bit x86 SMP  \nii linux-image-3.2.0-43-generic 3.2.0-43.68 Linux kernel image <span class=\"token keyword\">for</span> version 3.2.0 on 64 bit x86 SMP  \nii linux-image-3.2.0-44-generic 3.2.0-44.69 Linux kernel image <span class=\"token keyword\">for</span> version 3.2.0 on 64 bit x86 SMP  \nii linux-image-3.2.0-45-generic 3.2.0-45.70 Linux kernel image <span class=\"token keyword\">for</span> version 3.2.0 on 64 bit x86 SMP  \nii linux-image-3.2.0-48-generic 3.2.0-48.74 Linux kernel image <span class=\"token keyword\">for</span> version 3.2.0 on 64 bit x86 SMP  \nii linux-image-3.2.0-51-generic 3.2.0-51.77 Linux kernel image <span class=\"token keyword\">for</span> version 3.2.0 on 64 bit x86 SMP  \nii linux-image-3.2.0-52-generic 3.2.0-52.78 Linux kernel image <span class=\"token keyword\">for</span> version 3.2.0 on 64 bit x86 SMP  \nii linux-image-3.2.0-53-generic 3.2.0-53.81 Linux kernel image <span class=\"token keyword\">for</span> version 3.2.0 on 64 bit x86 SMP  \nii linux-image-3.2.0-54-generic 3.2.0-54.82 Linux kernel image <span class=\"token keyword\">for</span> version 3.2.0 on 64 bit x86 SMP  \niF linux-image-3.2.0-55-generic 3.2.0-55.85 Linux kernel image <span class=\"token keyword\">for</span> version 3.2.0 on 64 bit x86 SMP  \niF linux-image-3.2.0-56-generic 3.2.0-56.86 Linux kernel image <span class=\"token keyword\">for</span> version 3.2.0 on 64 bit x86 SMP  \niU linux-image-server 3.2.0.55.65 Linux kernel image on Server Equipment.  </code></pre></div>\n<p>Trying to remove the oldest one of these gives the error below</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">sudo</span> <span class=\"token function\">apt-get</span> purge linux-image-3.2.0-41-generic  \nReading package lists<span class=\"token punctuation\">..</span>. Done  \nBuilding dependency tree   \nReading state information<span class=\"token punctuation\">..</span>. Done  \nYou might want to run <span class=\"token string\">'apt-get -f install'</span> to correct these:  \nThe following packages have unmet dependencies:  \n linux-server <span class=\"token keyword\">:</span> Depends: linux-headers-server <span class=\"token punctuation\">(</span><span class=\"token operator\">=</span> 3.2.0.55.65<span class=\"token punctuation\">)</span> but 3.2.0.60.71 is to be installed  \nE: Unmet dependencies. Try <span class=\"token string\">'apt-get -f install'</span> with no packages <span class=\"token punctuation\">(</span>or specify a solution<span class=\"token punctuation\">)</span>.  </code></pre></div>\n<p>Get the current kernel and take note!</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">uname</span> -r  \n3.2.0-54-generic  </code></pre></div>\n<p>Make sure you don’t remove this image!</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">sudo</span> dpkg -r linux-image-3.2.0-41-generic  </code></pre></div>\n<p>and</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">sudo</span> dpkg --purge linux-image-3.2.0-41-generic  </code></pre></div>\n<p>Do this for a few of the older versions and you should have space again on the /boot partition  </p>\n<p>But you will now probably get</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">sudo</span> <span class=\"token function\">apt-get</span> -f <span class=\"token function\">install</span>  \nSetting up linux-image-server <span class=\"token punctuation\">(</span>3.2.0.60.71<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">..</span>.  \ndpkg: dependency problems prevent configuration of linux-server:  \n linux-server depends on linux-image-server <span class=\"token punctuation\">(</span><span class=\"token operator\">=</span> 3.2.0.55.65<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> however:  \n Version of linux-image-server on system is 3.2.0.60.71.  \n linux-server depends on linux-headers-server <span class=\"token punctuation\">(</span><span class=\"token operator\">=</span> 3.2.0.55.65<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> however:  \n Version of linux-headers-server on system is 3.2.0.60.71.  \ndpkg: error processing linux-server <span class=\"token punctuation\">(</span>--configure<span class=\"token punctuation\">)</span>:  \n dependency problems - leaving unconfigured  \nNo apport report written because the error message indicates its a followup error from a previous failure.  \n Errors were encountered <span class=\"token keyword\">while</span> processing:  \n linux-server  \nE: Sub-process /usr/bin/dpkg returned an error code <span class=\"token punctuation\">(</span>1<span class=\"token punctuation\">)</span>  </code></pre></div>\n<p>I’m not admin as you may have guessed but it’s a virtual server and I took a snapshot, anyway time to get nuclear on it.  </p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">sudo</span> dpkg --remove --force-remove-reinstreq linux-image-server  \n<span class=\"token function\">sudo</span> dpkg --remove --force-remove-reinstreq linux-headers-server  \n<span class=\"token function\">sudo</span> dpkg --remove --force-remove-reinstreq linux-server  </code></pre></div>\n<p>Then run -f install again</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">sudo</span> <span class=\"token function\">apt-get</span> -f <span class=\"token function\">install</span>  \nReading package lists<span class=\"token punctuation\">..</span>. Done  \nBuilding dependency tree   \nReading state information<span class=\"token punctuation\">..</span>. Done  \nThe following packages were automatically installed and are no longer required:  \n linux-headers-3.2.0-44-generic linux-headers-3.2.0-52-generic linux-headers-3.2.0-41 linux-headers-3.2.0-43 linux-headers-3.2.0-44 linux-headers-3.2.0-45 linux-headers-3.2.0-51 linux-headers-3.2.0-52 linux-headers-3.2.0-53  \n linux-headers-3.2.0-48 linux-headers-3.2.0-45-generic linux-headers-3.2.0-53-generic linux-headers-3.2.0-48-generic linux-headers-3.2.0-43-generic linux-headers-3.2.0-51-generic linux-headers-3.2.0-41-generic  \nUse <span class=\"token string\">'apt-get autoremove'</span> to remove them.  \n0 upgraded, 0 newly installed, 0 to remove and 130 not upgraded.  </code></pre></div>\n<p>Progress at last, clean up the old packages by following it’s recommendation</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">sudo</span> <span class=\"token function\">apt-get</span> autoremove  </code></pre></div>\n<p>Try the install again</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">sudo</span> <span class=\"token function\">apt-get</span> -f <span class=\"token function\">install</span>  \nReading package lists<span class=\"token punctuation\">..</span>. Done  \nBuilding dependency tree   \nReading state information<span class=\"token punctuation\">..</span>. Done  \n0 upgraded, 0 newly installed, 0 to remove and 130 not upgraded.  </code></pre></div>\n<p>You should now be in a happy state again, I found the below which should purge all the remaining old images, you might need to modify it if you want to keep more than the current</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">sudo</span> <span class=\"token function\">apt-get</span> purge <span class=\"token variable\"><span class=\"token variable\">$(</span>dpkg -l linux-<span class=\"token punctuation\">{</span>image,headers<span class=\"token punctuation\">}</span>-<span class=\"token string\">\"[0-9]*\"</span> <span class=\"token operator\">|</span> <span class=\"token function\">awk</span> <span class=\"token string\">'/ii/{print <span class=\"token variable\">$2</span>}'</span> <span class=\"token operator\">|</span> <span class=\"token function\">grep</span> -ve \"<span class=\"token punctuation\">$(</span>uname -r <span class=\"token operator\">|</span> <span class=\"token function\">sed</span> -r <span class=\"token string\">'s/-[a-z]+//'</span><span class=\"token variable\">)</span></span>\"<span class=\"token punctuation\">)</span>  </code></pre></div>\n<p>Should be back to normal now and can perform ann update and upgrade.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">sudo</span> <span class=\"token function\">apt-get</span> update  \n<span class=\"token function\">sudo</span> <span class=\"token function\">apt-get</span> upgrade  </code></pre></div>","frontmatter":{"title":"Ubuntu can't apt-get upgrade because boot partition is full","date":"April 23, 2014"}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/2014-04-23-ubuntu-cant-apt-get-upgrade-because/","previous":{"fields":{"slug":"/2014-04-23-java-mission-control-and-weblogic/"},"frontmatter":{"title":"Java Mission Control and Weblogic Dynamic Server"}},"next":{"fields":{"slug":"/2014-04-23-weblogic-setup-and-install-series/"},"frontmatter":{"title":"Weblogic setup and install series"}}}}