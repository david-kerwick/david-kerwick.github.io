{"data":{"site":{"siteMetadata":{"title":"Random Stuff About Stuff","author":"David Kerwick"}},"markdownRemark":{"id":"a4acd49d-1a47-5135-95e3-80228eb2ba66","excerpt":"The PHP project I’m looking at doesn’t have a ‘deployment’ process.  The advantage of interpreted languages I guess. The whole thing can be shipped to the…","html":"<p>The PHP project I’m looking at doesn’t have a ‘deployment’ process.  The advantage of interpreted languages I guess. The whole thing can be shipped to the production server, but that also means alot of files that don’t need to be on the server are on the server.  This does not sit well with my brain. So I think it’s time to create a folder for just deployment files and have the needed files copied to that folder.</p>\n<p>For that I’m going to use Gulp. Why not Grunt? Well the move seems to be away from poor Grunt but maybe I’m wrong. Gulp is also meant to be faster so that’s always good.</p>\n<p>NPM should be installed from the bower post so to install gulp globally.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">npm</span> <span class=\"token function\">install</span> -g gulp</code></pre></div>\n<p>Then go to your project folder. Now node will want a config file to store it’s dependencies. The project is going to be swimming in json files, going to have to do something about that soon it’s getting ridiculous this will be the third. Anyway</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">npm</span> init</code></pre></div>\n<p>answer the questions that make sense, it seems to pick up some sensible defaults.</p>\n<p>Then install gulp as a dev dependency.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">npm</span> <span class=\"token function\">install</span> gulp --save-dev</code></pre></div>\n<p>Next create a gulpfile.js in the project root.  Copying files in Gulp is very straight forward as two of the main api’s deal with getting files <code class=\"language-text\">gulp.src</code> and writing them out <code class=\"language-text\">gulp.dest</code>\nSo you copy the application folder to a dist directory you could use the below code. </p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">gulp<span class=\"token punctuation\">.</span><span class=\"token function\">task</span><span class=\"token punctuation\">(</span><span class=\"token string\">'dist-app'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n     <span class=\"token keyword\">return</span> gulp<span class=\"token punctuation\">.</span><span class=\"token function\">src</span><span class=\"token punctuation\">(</span><span class=\"token string\">'./application/**/*'</span><span class=\"token punctuation\">)</span>\n         <span class=\"token punctuation\">.</span><span class=\"token function\">pipe</span><span class=\"token punctuation\">(</span>gulp<span class=\"token punctuation\">.</span><span class=\"token function\">dest</span><span class=\"token punctuation\">(</span><span class=\"token string\">'./dist/application'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>You can then run it with</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">gulp dist-app</code></pre></div>\n<p>You can then build up a series of tasks to copy over what’s need for the production directory.</p>\n<p>I think it’s best to have the separate copies in different tasks, because then you can run them in parallel.\nOne gotcha is you will likely want to clean down the dist directory but if that kind of thing tries to run in parallel you are going to end up in a world of hurt.</p>\n<p>So say your delete task it like this</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">var</span> del <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'del'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\ngulp<span class=\"token punctuation\">.</span><span class=\"token function\">task</span><span class=\"token punctuation\">(</span><span class=\"token string\">'clean-dist'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Cleaning the dist folder'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span> <span class=\"token function\">del</span><span class=\"token punctuation\">(</span><span class=\"token string\">'dist/**/*'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>And you had two ‘copy’ tasks ‘dist-app’ and ‘dist-system’ which can run in parallel but clean must run first.\nWell there’s a module for that <code class=\"language-text\">run-sequence</code> and will look something like the below</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">var</span> runSequence <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'run-sequence'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\ngulp<span class=\"token punctuation\">.</span><span class=\"token function\">task</span><span class=\"token punctuation\">(</span><span class=\"token string\">'make-dist'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">callback</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">runSequence</span><span class=\"token punctuation\">(</span><span class=\"token string\">'clean-dist'</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">[</span><span class=\"token string\">'dist-app'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'dist-system'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n        callback<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>So each task is run in sequence and the array’s run in parallel.</p>\n<p>That’s a basic clean and copy to only pull in the folders needed from your production deploy.\nI.e. non of the .git stuff, *.json, etc…\nBut not exactly taking advantage of what gulp can do.</p>\n<p>It’s a good starting point though.</p>","frontmatter":{"title":"Using Gulp to create a 'deployment' directory for a php project","date":"May 04, 2016"}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/2016-05-04-using-gulp-to-create-a-deployment-directory-for-a-php-project/","previous":{"fields":{"slug":"/2016-05-04-using-bower-to-pull-in-external-dependencies/"},"frontmatter":{"title":"Using Bower to pull in external dependencies"}},"next":{"fields":{"slug":"/2016-05-04-using-gulp-to-pull-in-only-the-needed-bower-assests/"},"frontmatter":{"title":"Using Gulp to pull in only the needed bower assets"}}}}